<<<<<<< HEAD
function refresh(e){$$$(e)[0].contentWindow.location.reload()}function hide(e){$$$(e).hide()}function show(e){$$$(e).show()}function elementExists(e){return $$$(e).length?!0:void 0}var action=function(){var e={};return e.setup=function(e){data=e,panel_url=data.root_url+"/"+action.getOption("panel","panel")+"/pages/"+data.admin_slug+"/edit",site_url=data.root_url+"/"+data.page_slug},e.setView=function(e){$$$("body")[0].setAttribute("data-view",e),mem.setLocal("view",e)},e.is_json=function(e){try{JSON.parse(e)}catch(t){return!1}return!0},e.getOption=function(e,t){var n="";return n=data.hasOwnProperty(e)?data[e]:t},e.addIframe=function(e,t){var n=document.createElement("iframe");return n.src=t,$$$(e)[0].appendChild(n),n},e.debugData=function(){data.debug===!0&&(console.log("Options JS:"),console.log(data))},e}(),address=function(){var e={};return e.init=function(){address.setAddress("section.panel .url input",panel_url),address.setAddress("section.site .url input",site_url)},e.setAddress=function(e,t){$$$(e)[0].value=t},e.setAddresses=function(){var e=$$$("section.site iframe")[0].contentWindow.location.href,t=$$$("section.panel iframe")[0].contentWindow.location.href;site_url!=e&&(address.setAddress("section.site .url input",e),site_url=e),panel_url!=t&&(address.setAddress("section.panel .url input",t),panel_url=t)},e}(),dropdown=function(){var e={};e.init=function(){t()};var t=function(){n("panel"),n("site"),i()},n=function(e){$$$("section."+e+" .dropdown").forEach(function(t){var n=t.previousSibling.previousSibling;n.addEventListener("click",function(t){var i=$$$("body")[0].getAttribute("data-dropdown"),a=$$$("body")[0].getAttribute("data-bar"),c=n.parentNode.getAttribute("class"),s=c.split(" ")[0];i?(o(),(i!=s||a!=e)&&r(s,e)):r(s,e)})})},i=function(){$$$(".bar .hide .button").click(function(e){o()}),$$$(".bar .show .button").click(function(e){o()}),$$$(".bar .url .button-refresh").click(function(e){o()}),$$$(".bar .left").click(function(e){o()}),$$$(".dropdown li").click(function(e){o()})},o=function(){$$$("body")[0].removeAttribute("data-dropdown"),$$$("body")[0].removeAttribute("data-bar")},r=function(e,t){$$$("body")[0].setAttribute("data-dropdown",e),$$$("body")[0].setAttribute("data-bar",t)};return e}(),event=function(){var e={};return e.shared=function(e){event.exit(e),event.view(e),event.enterUrl(e),event.refresh(e)},e.events=function(){event.shared("panel"),event.shared("site"),event.buttonView("panel"),event.buttonView("site"),event.buttonView("columns"),event.buttonView("rows")},e.refresh=function(e){$$$("section."+e+" .button-refresh").click(function(t){refresh("section."+e+" iframe")})},e.view=function(e){$$("li."+e).forEach(function(t){t.addEventListener("click",function(t){action.setView(e)})})},e.buttonView=function(e){$$$(".dropdown li."+e).click(function(t){action.setView(e)})},e.enterUrl=function(e){$$$("section."+e+" .url input").keypress(function(t){if(13==event.keyCode){var n=$$$("section."+e+" .url input")[0].value;$$$("section."+e+" iframe")[0].setAttribute("src",n)}})},e.exit=function(e){$$("section."+e+" li.exit").forEach(function(t){t.addEventListener("click",function(t){window.location.href=$$$("section."+e+" iframe")[0].contentWindow.document.location.href})})},e}(),$$=function(e,t){t=t||document;var n=t.querySelectorAll(e);return Array.prototype.slice.call(n)},$$$=function(e,t){t=t||document;var n=Array.prototype.slice.call(t.querySelectorAll(e));return n.click=function(e){n.forEach(function(t){t.addEventListener("click",function(t){t.stopPropagation(),e.apply(n,[t])})})},n.keypress=function(e){n.forEach(function(t){t.addEventListener("keypress",function(t){t.stopPropagation(),e.apply(n,[t])})})},n.show=function(e){n.forEach(function(e){e.classList.add("active")})},n.hide=function(e){n.forEach(function(e){e.classList.remove("active")})},n.blur=function(e){n.forEach(function(e){e.blur()})},n.focus=function(e){n.forEach(function(e){e.focus()})},n.toggle=function(e){n.forEach(function(e){e.classList.toggle("active")})},n.hasClass=function(e){n.forEach(function(t){return t.classList.contains(e)?!0:void 0})},n},mem=function(){var e={};return e.init=function(){mem.setMemory(),mem.loadMemory()},e.setLocal=function(e,t){memory[e]=t;var n=JSON.stringify(memory);localStorage.setItem("splitview.memory",n)},e.setMemory=function(){if(localStorage.getItem("splitview.memory")){var e=localStorage.getItem("splitview.memory");action.is_json(e)&&(memory=JSON.parse(e))}},e.getMemory=function(e,t){var n="";return n=memory&&memory.hasOwnProperty(e)?memory[e]:t},e.loadMemory=function(){data.memory===!0?action.setView(mem.getMemory("view","columns")):action.setView(action.getOption("view","columns"))},e}(),menu=function(){var e={};e.init=function(){t()};var t=function(){n("panel"),i("panel"),n("site"),i("site")},n=function(e){var t="section."+e+" .bar li.hide";$$$(t+" .button").click(function(t){var n=$$$("body")[0].getAttribute("data-menu-"+e);"true"!==n&&$$$("body")[0].setAttribute("data-menu-"+e,!0)})},i=function(e){var t="section."+e+" .bar li.show";$$$(t+" .button").click(function(n){console.log(t);var i=$$$("body")[0].getAttribute("data-menu-"+e);"true"===i&&$$$("body")[0].removeAttribute("data-menu-"+e)})};return e}(),panel=function(){var e={};e.init=function(){t()};var t=function(){n("section.panel li.sync")},n=function(e){$$$(e).forEach(function(e){e.addEventListener("click",function(e){l()})})};e.panelMessageHide=function(){var e=document.createElement("style"),t=$$$("section.panel iframe")[0].contentWindow.document.querySelector("body").appendChild(e);t.innerHTML=".message { display: none; }"};var i=function(e){$$$("section.panel .message-saved")[0].classList.remove("active"),$$$("section.site .message-saved")[0].classList.remove("active")},o=function(e){$$$("section.panel .message-error")[0].classList.remove("active"),$$$("section.site .message-error")[0].classList.remove("active")},r=function(e,t){return str=t.slice(-e.length),str===e&&(t=t.slice(0,-e.length)),t};e.triggerErrorMessage=function(){var e=$$$("section.panel iframe")[0].contentWindow.document.querySelector(".message-is-alert");e&&(e.remove(),$$$("section.panel .message-error")[0].classList.add("active"),$$$("section.site .message-error")[0].classList.add("active"),setTimeout(o,4e3))},e.triggerSavedMessage=function(){var e=$$$("section.panel iframe")[0].contentWindow.document.querySelector(".message-is-notice");e?panel_state="saved":(panel_refreshed=!1,panel_state="closed"),"saved"===panel_state&&0==panel_refreshed&&(e.remove(),$$$("section.panel .message-saved")[0].classList.add("active"),$$$("section.site .message-saved")[0].classList.add("active"),refresh("section.site iframe"),panel_refreshed=!0,setTimeout(i,4e3))};var a=function(e){return e=e.split("/file/")[0],e=r("/edit",e),e=r("/files",e),e=r("/subpages",e)},c=function(){return $$$("section.panel iframe")[0].contentWindow.location.href},s=function(){return data.root_url+"/"+action.getOption("panel","panel")+"/pages"},u=function(){return c().replace(s(),"")},l=function(){var e=a(u());site_url=data.root_url+e,site.setUrl(site_url)};return e}(),site=function(){var e={};return e.setUrl=function(e){$$$("section.site iframe")[0].contentWindow.location.href=e},e}(),data={},iframe_count=0,panel_url,site_url,panel_state,panel_refreshed=!0,memory={},splitview=function(){var e={};return e.init=function(e){panel.init(),action.setup(e),action.debugData(),action.addIframe("section.panel .iframe",panel_url),action.addIframe("section.site .iframe",site_url),menu.init(),dropdown.init(),address.init(),surface.init(),mem.init(),copy.init(),SiteSync.init(),event.events()},e}(),surface=function(){var e={};return e.init=function(){surface.focusRootOnLoad("section.panel iframe"),surface.focusRootOnLoad("section.site iframe")},e.focus=function(e){$$$(e).focus()},e.blur=function(e){$$$(e).blur()},e.focusRoot=function(){surface.blur("section.panel iframe"),surface.blur("section.site iframe"),surface.focus(".splitview")},e.focusRootOnLoad=function(e){iframe=$$$(e)[0],iframe.onload=function(){iframe_count++,2==iframe_count&&(surface.focusRoot(),panel.panelMessageHide(),timeloop.events())}},e}(),timeloop=function(){var e={};return e.events=function(){address.setAddresses(),panel.triggerSavedMessage(),panel.triggerErrorMessage(),setTimeout(timeloop.events,200)},e}(),copy=function(){var e={};e.init=function(){t()};var t=function(){$$$("section.panel .flash .copy").click(function(e){n()}),$$$("section.site .flash .copy").click(function(e){i()})},n=function(){var e=$$$("section.panel iframe")[0].contentWindow.document.location.href;$$$("section.site iframe")[0].contentWindow.document.location.href=e},i=function(){var e=$$$("section.site iframe")[0].contentWindow.document.location.href;$$$("section.panel iframe")[0].contentWindow.document.location.href=e};return e}(),SiteSync=function(){var e={};e.init=function(){t()};var t=function(){n("section.site li.sync")},n=function(e){$$$(e).click(function(e){i()})},i=function(){if(r()){var e=r().getAttribute("data-splitview-id");$$$("section.panel iframe")[0].contentWindow.document.location.href=o(e)}},o=function(e){return data.root_url+"/"+action.getOption("panel","panel")+"/pages/"+e+"/edit"},r=function(){var e=document.querySelector("section.site iframe"),t=e.contentWindow.document.querySelector(".splitview-data");return t};return e}();
=======
var splitview=function(){var e,n,t,i={},o={},c=0,a=!0,r={};i.init=function(t){document.addEventListener("DOMContentLoaded",function(){m(t),w(),L("section.panel .iframe",e),L("section.site .iframe",n),h("section.panel .url input",e),h("section.site .url input",n),v("section.panel iframe"),v("section.site iframe"),s(),u(),$()})};var s=function(){localStorage.getItem("splitview.memory")&&(local_memory=localStorage.getItem("splitview.memory"),l(local_memory)&&(r=JSON.parse(local_memory)))},l=function(e){try{JSON.parse(e)}catch(n){return!1}return!0},u=function(){"true"===o.memory?(T(d("orientation","columns")),N(d("view","grid"))):(T(f("orientation","columns")),N(f("view","grid")))},d=function(e,n){var t="";return t=r&&r.hasOwnProperty(e)?r[e]:n},f=function(e,n){var t="";return t=o.hasOwnProperty(e)?o[e]:n},m=function(t){o=JSON.parse(t),e=o.root_url+"/"+f("panel","panel")+"/pages/"+o.admin_slug+"/edit",n=o.root_url+"/"+o.page_slug},v=function(e){iframe=E(e),iframe.onload=function(){c++,2==c&&(g(),p(),P())}},p=function(){style_element=document.createElement("style"),node=E("section.panel iframe").contentWindow.document.querySelector("body").appendChild(style_element),node.innerHTML=".message { display: none; }"},_=function(e){E(e).focus()},y=function(e){E(e).blur()},g=function(){y("section.panel iframe"),y("section.site iframe"),_(".splitview")},w=function(){o.debug===!0&&(console.log("Options JS:"),console.log(o))},h=function(e,n){E(e).value=n},L=function(e,n){var t=document.createElement("iframe");return t.src=n,E(e).appendChild(t),t},E=function(e){return document.querySelector(e)},b=function(e,n){n=n||document;var t=n.querySelectorAll(e);return Array.prototype.slice.call(t)},S=function(e){b("li."+e).forEach(function(n){n.addEventListener("click",function(n){N(e)})})},k=function(e){b("li."+e).forEach(function(n){n.addEventListener("click",function(n){T(e),N("grid")})})},A=function(){b("li.close-dropdown").forEach(function(e){e.addEventListener("click",function(e){I(this)})})},W=function(e){E("section."+e+" li.refresh").addEventListener("click",function(n){C("section."+e+" iframe")})},O=function(e){E("section."+e+" .url input").addEventListener("keypress",function(){if(13==event.keyCode){var n=E("section."+e+" .url input").value;E("section."+e+" iframe").setAttribute("src",n)}})},q=function(e){b("li.close-"+e).forEach(function(n){n.addEventListener("click",function(n){window.location.href=E("section."+e+" iframe").contentWindow.document.location.href})})},J=function(){window.addEventListener("click",function(e){e=e||window.event;var n=e.target||e.srcElement,t=n.getAttribute("class");"fa fa-sign-out"!==t&&"close-dropdown"!==t&&b("li.close-dropdown ul.dropdown").forEach(function(e){e.classList.remove("active")})})},C=function(e){E(e).contentWindow.location.reload()},N=function(e){E("body").setAttribute("data-view",e),M("view",e)},T=function(e){E("body").setAttribute("data-orientation",e),M("orientation",e)},I=function(e){e.querySelector(".dropdown").classList.toggle("active")},M=function(e,n){r[e]=n,local_memory=JSON.stringify(r),localStorage.setItem("splitview.memory",local_memory),console.log(r)},P=function(){H(),D(),x(),setTimeout(P,200)},x=function(){element=E("section.panel iframe").contentWindow.document.querySelector(".message-is-alert"),element&&(element.remove(),E("section.panel .message-error").classList.add("active"),E("section.site .message-error").classList.add("active"),setTimeout(z,4e3))},D=function(){element=E("section.panel iframe").contentWindow.document.querySelector(".message-is-notice"),element?t="saved":(a=!1,t="closed"),"saved"===t&&0==a&&(element.remove(),E("section.panel .message-saved").classList.add("active"),E("section.site .message-saved").classList.add("active"),C("section.site iframe"),a=!0,setTimeout(j,4e3))},H=function(){new_site_url=E("section.site iframe").contentWindow.location.href,new_panel_url=E("section.panel iframe").contentWindow.location.href,n!=new_site_url&&(h("section.site .url input",new_site_url),n=new_site_url),e!=new_panel_url&&(h("section.panel .url input",new_panel_url),e=new_panel_url)},j=function(e){E("section.panel .message-saved").classList.remove("active"),E("section.site .message-saved").classList.remove("active")},z=function(e){E("section.panel .message-error").classList.remove("active"),E("section.site .message-error").classList.remove("active")},B=function(){var e=document.querySelector("section.site iframe"),n=e.contentWindow.document.querySelector(".splitview-data").getAttribute("data-splitview-id");E("section.panel iframe").contentWindow.document.location.href=o.root_url+"/"+f("panel","panel")+"/pages/"+n+"/edit"},F=function(){var e=E("section.panel iframe").contentWindow.location.href,n=o.root_url+"/"+f("panel","panel")+"/pages",t=e.replace(n,""),i=t.split("/file/");admin_uri_page=G("/edit",i[0]),admin_uri_page=G("/files",admin_uri_page),admin_uri_page=G("/subpages",admin_uri_page),-1==admin_uri_page.indexOf(o.root_url)&&(admin_uri=admin_uri_page),new_site_url=o.root_url+admin_uri,E("section.site iframe").contentWindow.location.href=new_site_url},G=function(e,n){return str=n.slice(-e.length),str===e&&(n=n.slice(0,-e.length)),n},K=function(e){b(e).forEach(function(e){e.addEventListener("click",function(e){B(),E("body").removeAttribute("data-overlay"),V()})})},Q=function(e){b(e).forEach(function(e){e.addEventListener("click",function(e){F(),E("body").removeAttribute("data-overlay"),V()})})},R=function(e,n){b(e).forEach(function(e){e.addEventListener("click",function(t){var i=e.classList.contains("active");V(),i?(Y("li."+n),E("body").removeAttribute("data-overlay")):(X("li."+n),E("body").setAttribute("data-overlay",n))})})},U=function(){b(".overlay").forEach(function(e){e.addEventListener("click",function(e){V(),E("body").removeAttribute("data-overlay")})})},V=function(){b("nav li").forEach(function(e){e.classList.remove("active")})},X=function(e){b("nav "+e).forEach(function(e){e.classList.add("active")})},Y=function(e){b("nav "+e).forEach(function(e){e.classList.remove("active")})},Z=function(e){q(e),S(e),O(e),W(e)},$=function(){A(),J(),k("columns"),k("rows"),Z("panel"),Z("site"),K("section.site .button-sync"),Q("section.panel .button-sync"),R("nav .sync","sync"),U()};return i}();
>>>>>>> origin/master
