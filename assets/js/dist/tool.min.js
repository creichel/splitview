var splitview=function(){var e,n,t,i={},o={},c=0,a=!0,r={};i.init=function(t){document.addEventListener("DOMContentLoaded",function(){m(t),w(),L("section.panel .iframe",e),L("section.site .iframe",n),h("section.panel .url input",e),h("section.site .url input",n),v("section.panel iframe"),v("section.site iframe"),s(),u(),$()})};var s=function(){localStorage.getItem("splitview.memory")&&(local_memory=localStorage.getItem("splitview.memory"),l(local_memory)&&(r=JSON.parse(local_memory)))},l=function(e){try{JSON.parse(e)}catch(n){return!1}return!0},u=function(){"true"===o.memory?(T(d("orientation","columns")),N(d("view","grid"))):(T(f("orientation","columns")),N(f("view","grid")))},d=function(e,n){var t="";return t=r&&r.hasOwnProperty(e)?r[e]:n},f=function(e,n){var t="";return t=o.hasOwnProperty(e)?o[e]:n},m=function(t){o=JSON.parse(t),e=o.root_url+"/"+f("panel","panel")+"/pages/"+o.admin_slug+"/edit",n=o.root_url+"/"+o.page_slug},v=function(e){iframe=E(e),iframe.onload=function(){c++,2==c&&(g(),p(),P())}},p=function(){style_element=document.createElement("style"),node=E("section.panel iframe").contentWindow.document.querySelector("body").appendChild(style_element),node.innerHTML=".message { display: none; }"},_=function(e){E(e).focus()},y=function(e){E(e).blur()},g=function(){y("section.panel iframe"),y("section.site iframe"),_(".splitview")},w=function(){o.debug===!0&&(console.log("Options JS:"),console.log(o))},h=function(e,n){E(e).value=n},L=function(e,n){var t=document.createElement("iframe");return t.src=n,E(e).appendChild(t),t},E=function(e){return document.querySelector(e)},b=function(e,n){n=n||document;var t=n.querySelectorAll(e);return Array.prototype.slice.call(t)},S=function(e){b("li."+e).forEach(function(n){n.addEventListener("click",function(n){N(e)})})},k=function(e){b("li."+e).forEach(function(n){n.addEventListener("click",function(n){T(e),N("grid")})})},A=function(){b("li.close-dropdown").forEach(function(e){e.addEventListener("click",function(e){I(this)})})},W=function(e){E("section."+e+" li.refresh").addEventListener("click",function(n){C("section."+e+" iframe")})},O=function(e){E("section."+e+" .url input").addEventListener("keypress",function(){if(13==event.keyCode){var n=E("section."+e+" .url input").value;E("section."+e+" iframe").setAttribute("src",n)}})},q=function(e){b("li.close-"+e).forEach(function(n){n.addEventListener("click",function(n){window.location.href=E("section."+e+" iframe").contentWindow.document.location.href})})},J=function(){window.addEventListener("click",function(e){e=e||window.event;var n=e.target||e.srcElement,t=n.getAttribute("class");"fa fa-sign-out"!==t&&"close-dropdown"!==t&&b("li.close-dropdown ul.dropdown").forEach(function(e){e.classList.remove("active")})})},C=function(e){E(e).contentWindow.location.reload()},N=function(e){E("body").setAttribute("data-view",e),M("view",e)},T=function(e){E("body").setAttribute("data-orientation",e),M("orientation",e)},I=function(e){e.querySelector(".dropdown").classList.toggle("active")},M=function(e,n){r[e]=n,local_memory=JSON.stringify(r),localStorage.setItem("splitview.memory",local_memory),console.log(r)},P=function(){H(),D(),x(),setTimeout(P,200)},x=function(){element=E("section.panel iframe").contentWindow.document.querySelector(".message-is-alert"),element&&(element.remove(),E("section.panel .message-error").classList.add("active"),E("section.site .message-error").classList.add("active"),setTimeout(z,4e3))},D=function(){element=E("section.panel iframe").contentWindow.document.querySelector(".message-is-notice"),element?t="saved":(a=!1,t="closed"),"saved"===t&&0==a&&(element.remove(),E("section.panel .message-saved").classList.add("active"),E("section.site .message-saved").classList.add("active"),C("section.site iframe"),a=!0,setTimeout(j,4e3))},H=function(){new_site_url=E("section.site iframe").contentWindow.location.href,new_panel_url=E("section.panel iframe").contentWindow.location.href,n!=new_site_url&&(h("section.site .url input",new_site_url),n=new_site_url),e!=new_panel_url&&(h("section.panel .url input",new_panel_url),e=new_panel_url)},j=function(e){E("section.panel .message-saved").classList.remove("active"),E("section.site .message-saved").classList.remove("active")},z=function(e){E("section.panel .message-error").classList.remove("active"),E("section.site .message-error").classList.remove("active")},B=function(){var e=document.querySelector("section.site iframe"),n=e.contentWindow.document.querySelector(".splitview-data").getAttribute("data-splitview-id");E("section.panel iframe").contentWindow.document.location.href=o.root_url+"/"+f("panel","panel")+"/pages/"+n+"/edit"},F=function(){var e=E("section.panel iframe").contentWindow.location.href,n=o.root_url+"/"+f("panel","panel")+"/pages",t=e.replace(n,""),i=t.split("/file/");admin_uri_page=G("/edit",i[0]),admin_uri_page=G("/files",admin_uri_page),admin_uri_page=G("/subpages",admin_uri_page),-1==admin_uri_page.indexOf(o.root_url)&&(admin_uri=admin_uri_page),new_site_url=o.root_url+admin_uri,E("section.site iframe").contentWindow.location.href=new_site_url},G=function(e,n){return str=n.slice(-e.length),str===e&&(n=n.slice(0,-e.length)),n},K=function(e){b(e).forEach(function(e){e.addEventListener("click",function(e){B(),E("body").removeAttribute("data-overlay"),V()})})},Q=function(e){b(e).forEach(function(e){e.addEventListener("click",function(e){F(),E("body").removeAttribute("data-overlay"),V()})})},R=function(e,n){b(e).forEach(function(e){e.addEventListener("click",function(t){var i=e.classList.contains("active");V(),i?(Y("li."+n),E("body").removeAttribute("data-overlay")):(X("li."+n),E("body").setAttribute("data-overlay",n))})})},U=function(){b(".overlay").forEach(function(e){e.addEventListener("click",function(e){V(),E("body").removeAttribute("data-overlay")})})},V=function(){b("nav li").forEach(function(e){e.classList.remove("active")})},X=function(e){b("nav "+e).forEach(function(e){e.classList.add("active")})},Y=function(e){b("nav "+e).forEach(function(e){e.classList.remove("active")})},Z=function(e){q(e),S(e),O(e),W(e)},$=function(){A(),J(),k("columns"),k("rows"),Z("panel"),Z("site"),K("section.site .button-sync"),Q("section.panel .button-sync"),R("nav .sync","sync"),U()};return i}();